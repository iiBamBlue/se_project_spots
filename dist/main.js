!function(){"use strict";var e="/se_project_spots/";const t={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__submit-button",inactiveButtonClass:"modal__submit-button_disabled",inputErrorClass:"modal__input_type_error",errorClass:"modal__error"},r=e=>{console.error(`Validation Error: ${e}`)},o=(e,t,o)=>{const n=e.querySelector(`#${t.id}-error`);n?(n.textContent="",n.removeAttribute("role"),t.classList.remove(o.inputErrorClass)):r(`Error message element for input ${t.id} not found.`)},n=(e,t,r)=>{(e=>e.some((e=>!e.validity.valid)))(e)?a(t,r):(t.disabled=!1,t.classList.remove(r.inactiveButtonClass))},a=(e,t)=>{e.disabled=!0,e.classList.add(t.inactiveButtonClass)},s=(e,t,r)=>{t.forEach((t=>{o(e,t,r)}));const n=e.querySelector(r.submitButtonSelector);a(n,r)};function i(e,t,r="Save",o="Saving..."){t.textContent=e?o:r}function l(e){let t="Something went wrong. Please try again.";if("string"==typeof e&&e.includes("Error: ")){const r=e.match(/Error: (\d+)/)?.[1];switch(r){case"400":t="Invalid request. Please check your input.";break;case"401":t="Authentication failed. Please refresh and try again.";break;case"403":t="You do not have permission to perform this action.";break;case"404":t="The requested resource was not found.";break;case"500":t="Server error. Please try again later.";break;default:t=`Request failed (${r}). Please try again.`}}else e instanceof TypeError&&(t="Network error. Please check your connection.");return console.error("API Error:",e),function(e,t=5e3){const r=document.createElement("div");r.className="error-notification",r.textContent=e,r.setAttribute("role","alert"),r.setAttribute("aria-live","polite"),document.body.appendChild(r),setTimeout((()=>{r.parentNode&&r.parentNode.removeChild(r)}),t)}(t),t}const c={apiBaseUrl:process.env.API_BASE_URL||"https://around-api.en.tripleten-services.com/v1",apiToken:process.env.API_TOKEN||"f1f1dbab-8e17-48d3-a098-d77dfd6ea3c5"};var d=e+"5e2464bff616faf70484.svg",u=e+"2fc47fd8e9a9bcd9612f.jpg",m=e+"49e44e5e03758262e8bf.svg",_=e+"975792ea68af0a3c209d.svg",f=e+"c81b22e9874268723f8d.svg";const v=document.querySelector(".header__logo"),h=document.querySelector(".profile__avatar"),y=document.querySelector(".profile__edit-button img"),p=document.querySelector(".profile__add-button img"),S=document.querySelector(".profile__pencilIcon");v&&(v.src=d),h&&(h.src=u),y&&(y.src=m),p&&(p.src=_),S&&(S.src=f);const k=new class{constructor(e){this._baseUrl=e.baseUrl,this._headers=e.headers}_checkResponse(e){return e.ok?e.json():Promise.reject(`Error: ${e.status}`)}_request(e,t={}){const r={headers:this._headers,...t},o=`${this._baseUrl}${e}`;return fetch(o,r).then(this._checkResponse)}getUserInfo(){return this._request("/users/me")}getInitialCards(){return this._request("/cards",{method:"GET"})}editUserInfo({name:e,about:t}){return this._request("/users/me",{method:"PATCH",body:JSON.stringify({name:e,about:t})})}updateAvatar({avatar:e}){return this._request("/users/me/avatar",{method:"PATCH",body:JSON.stringify({avatar:e})})}addCard({name:e,link:t}){return this._request("/cards",{method:"POST",body:JSON.stringify({name:e,link:t})})}removeCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then(this._checkResponse)}likeCard(e){return this._request(`/cards/${e}/likes`,{method:"PUT"})}dislikeCard(e){return this._request(`/cards/${e}/likes`,{method:"DELETE"})}fetchInitialData(){return Promise.all([this.getUserInfo(),this.getInitialCards()])}}({baseUrl:c.apiBaseUrl,headers:{authorization:c.apiToken,"Content-Type":"application/json"}});let b;k.getUserInfo().then((e=>(b=e._id,g&&(g.textContent=e.name),C&&(C.textContent=e.about),D&&(D.src=e.avatar),k.getInitialCards()))).then((e=>{M&&Array.isArray(e)?e.forEach((e=>{const t=V(e);t&&M.append(t)})):console.error("Cards list element not found or cards data is invalid")})).catch(l);const q=document.querySelector(".profile__edit-button"),E=document.querySelector(".profile__add-button"),g=document.querySelector(".profile__name"),C=document.querySelector(".profile__description"),L=document.querySelectorAll(".modal__close-button"),w=document.querySelector("#delete-modal"),x=w?.querySelector("#delete-form"),A=w?.querySelector(".modal__cancel-button"),P=document.querySelector(".profile__avatar-button"),T=document.querySelector("#new-avatar-modal"),I=T?.querySelector(".modal__form"),U=T?.querySelector("#new-avatar-link-input"),D=document.querySelector(".profile__avatar"),$=document.querySelector("#edit-modal"),B=$?.querySelector(".modal__form"),N=$?.querySelector("#profile-name-input"),O=$?.querySelector("#profile-description-input"),j=document.querySelector("#new-card-modal"),K=j?.querySelector(".modal__form"),R=j?.querySelector("#new-card-link-input"),J=j?.querySelector("#new-card-caption-input"),H=document.querySelector("#preview-modal"),z=H?.querySelector(".modal__image"),F=H?.querySelector(".modal__caption"),G=document.querySelector("#card-template"),M=document.querySelector(".cards__list");function V(e){if(!G)return console.error("Card template not found"),null;const t=G.content.querySelector(".card").cloneNode(!0);t._id=e._id;const r=t.querySelector(".card__title"),o=t.querySelector(".card__image"),n=t.querySelector(".card__like-button"),a=t.querySelector(".card__like-count"),s=t.querySelector(".card__delete-button");r&&(r.textContent=e.name),o&&(o.src=e.link,o.alt=e.name,o.onerror=function(){console.error("Failed to load image:",e.link),this.src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100'%3E%3Crect width='100' height='100' fill='%23f0f0f0'/%3E%3Ctext x='50' y='50' text-anchor='middle' dy='.3em'%3EImage not found%3C/text%3E%3C/svg%3E"});const i=e.likes?e.likes.length:0,c=e.likes&&e.likes.some((e=>e._id===b));return a&&(a.textContent=i.toString()),n&&c&&n.classList.add("card__like-button_liked"),n.addEventListener("click",(()=>{(n.classList.contains("card__like-button_liked")?k.dislikeCard(e._id):k.likeCard(e._id)).then((e=>{const t=e.likes&&e.likes.some((e=>e._id===b)),r=e.likes?e.likes.length:0;n.classList.toggle("card__like-button_liked",t),a.textContent=r.toString()})).catch((e=>{l(e)}))})),s.addEventListener("click",(()=>{Y(w),x._cardToDelete=t})),o.addEventListener("click",(()=>{Y(H),F.textContent=e.name,z.alt=e.name,z.src=e.link})),t}function Y(e){function t(t){t.target.classList.contains("modal_opened")&&Q(e)}function r(t){"Escape"===t.key&&Q(e)}e.classList.add("modal_opened"),e._handleOverlayClick&&document.removeEventListener("click",e._handleOverlayClick),e._handleEscapeKeyPress&&document.removeEventListener("keydown",e._handleEscapeKeyPress),e._handleOverlayClick=t,e._handleEscapeKeyPress=r,document.addEventListener("click",t),document.addEventListener("keydown",r)}function Q(e){e.classList.remove("modal_opened"),document.removeEventListener("click",e._handleOverlayClick),document.removeEventListener("keydown",e._handleEscapeKeyPress)}function W(){const e=N.value,t=O.value;return k.editUserInfo({name:e,about:t}).then((e=>{g.textContent=e.name,C.textContent=e.about,Q($)}))}L.forEach((e=>{const t=e.closest(".modal");e.addEventListener("click",(()=>Q(t)))})),q.addEventListener("click",(()=>{N.value=g.textContent,O.value=C.textContent,s(B,[N,O],t),Y($)})),P.addEventListener("click",(()=>{Y(T)})),E.addEventListener("click",(()=>{Y(j)})),A.addEventListener("click",(()=>{Q(w)})),B.addEventListener("submit",(function(e){!function(e,t,r="Saving..."){t.preventDefault();const o=t.submitter,n=o.textContent;i(!0,o,n,r),e().catch(console.error).finally((()=>{i(!1,o,n)}))}(W,e,"Saving...")})),K.addEventListener("submit",(function(e){e.preventDefault();const t=K.querySelector(".modal__submit-button");i(!0,t),k.addCard({name:J.value,link:R.value}).then((t=>{const r=V(t);M.prepend(r),e.target.reset(),Q(j)})).catch(l).finally((()=>{i(!1,t)}))})),x.addEventListener("submit",(e=>{e.preventDefault();const t=x.querySelector(".modal__submit-button");i(!0,t,"Delete","Deleting..."),k.removeCard(x._cardToDelete._id).then((()=>{x._cardToDelete.remove(),Q(w)})).catch(l).finally((()=>{i(!1,t,"Delete")}))})),I.addEventListener("submit",(e=>{e.preventDefault();const t=I.querySelector(".modal__submit-button");i(!0,t),k.updateAvatar({avatar:U.value}).then((t=>{D&&(D.src=t.avatar),e.target.reset(),Q(T)})).catch(l).finally((()=>{i(!1,t)}))})),(e=>{document.querySelectorAll(e.formSelector).forEach((t=>{const a=Array.from(t.querySelectorAll(e.inputSelector));((e,t)=>{const a=Array.from(e.querySelectorAll(t.inputSelector)),s=e.querySelector(t.submitButtonSelector);n(a,s,t),a.forEach((i=>{i.addEventListener("input",(()=>{((e,t,n)=>{t.validity.valid?o(e,t,n):((e,t,o,n)=>{const a=e.querySelector(`#${t.id}-error`);a?(a.textContent=o,a.setAttribute("role","alert"),t.classList.add(n.inputErrorClass)):r(`Error message element for input ${t.id} not found.`)})(e,t,t.validationMessage,n)})(e,i,t),n(a,s,t)}))}))})(t,e),t.addEventListener("reset",(()=>{s(t,a,e)}))}))})(t)}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QWFDLEVBQWNDLEdBQzlDUSxFQUFrQkMsRUFBV0MsRUFBZVYsRUFBTyxHQUNuRCxHQUNGLEVBV0EyTCxDQUFrQjdMLEVBQWFFLEdBRy9CRixFQUFZNkosaUJBQWlCLFNBQVMsS0FDcEN4SSxFQUFnQnJCLEVBQWFXLEVBQVdULEVBQU8sR0FDL0MsR0FDRixFSThOSmdNLENBQWlCOU0sRSIsInNvdXJjZXMiOlsid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy93ZWJwYWNrL3J1bnRpbWUvcHVibGljUGF0aCIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3NjcmlwdHMvdmFsaWRhdGlvbi5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3V0aWxzL3V0aWxzLmpzIiwid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvdXRpbHMvZXJyb3JIYW5kbGVyLmpzIiwid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvdXRpbHMvY29uZmlnLmpzIiwid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvcGFnZXMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy91dGlscy9BcGkuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gVGhlIHJlcXVpcmUgc2NvcGVcbnZhciBfX3dlYnBhY2tfcmVxdWlyZV9fID0ge307XG5cbiIsIl9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiL3NlX3Byb2plY3Rfc3BvdHMvXCI7IiwiZXhwb3J0IGNvbnN0IHNldHRpbmdzID0ge1xyXG4gIGZvcm1TZWxlY3RvcjogXCIubW9kYWxfX2Zvcm1cIixcclxuICBpbnB1dFNlbGVjdG9yOiBcIi5tb2RhbF9faW5wdXRcIixcclxuICBzdWJtaXRCdXR0b25TZWxlY3RvcjogXCIubW9kYWxfX3N1Ym1pdC1idXR0b25cIixcclxuICBpbmFjdGl2ZUJ1dHRvbkNsYXNzOiBcIm1vZGFsX19zdWJtaXQtYnV0dG9uX2Rpc2FibGVkXCIsXHJcbiAgaW5wdXRFcnJvckNsYXNzOiBcIm1vZGFsX19pbnB1dF90eXBlX2Vycm9yXCIsXHJcbiAgZXJyb3JDbGFzczogXCJtb2RhbF9fZXJyb3JcIixcclxufTtcclxuXHJcbi8vIFV0aWxpdHkgZm9yIGxvZ2dpbmcgZXJyb3JzXHJcbmNvbnN0IGxvZ0Vycm9yID0gKG1lc3NhZ2UpID0+IHtcclxuICBjb25zb2xlLmVycm9yKGBWYWxpZGF0aW9uIEVycm9yOiAke21lc3NhZ2V9YCk7XHJcbn07XHJcblxyXG4vLyBTaG93IGlucHV0IGVycm9yIG1lc3NhZ2VcclxuY29uc3Qgc2hvd0lucHV0RXJyb3IgPSAoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgZXJyb3JNZXNzYWdlLCBjb25maWcpID0+IHtcclxuICBjb25zdCBlcnJvck1lc3NhZ2VFbGVtZW50ID0gZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihcclxuICAgIGAjJHtpbnB1dEVsZW1lbnQuaWR9LWVycm9yYFxyXG4gICk7XHJcblxyXG4gIGlmICghZXJyb3JNZXNzYWdlRWxlbWVudCkge1xyXG4gICAgbG9nRXJyb3IoYEVycm9yIG1lc3NhZ2UgZWxlbWVudCBmb3IgaW5wdXQgJHtpbnB1dEVsZW1lbnQuaWR9IG5vdCBmb3VuZC5gKTtcclxuICAgIHJldHVybjtcclxuICB9XHJcblxyXG4gIGVycm9yTWVzc2FnZUVsZW1lbnQudGV4dENvbnRlbnQgPSBlcnJvck1lc3NhZ2U7XHJcbiAgZXJyb3JNZXNzYWdlRWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJyb2xlXCIsIFwiYWxlcnRcIik7IC8vIEFjY2Vzc2liaWxpdHkgZW5oYW5jZW1lbnRcclxuICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LmFkZChjb25maWcuaW5wdXRFcnJvckNsYXNzKTtcclxufTtcclxuXHJcbi8vIEhpZGUgaW5wdXQgZXJyb3IgbWVzc2FnZVxyXG5jb25zdCBoaWRlSW5wdXRFcnJvciA9IChmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBjb25maWcpID0+IHtcclxuICBjb25zdCBlcnJvck1lc3NhZ2VFbGVtZW50ID0gZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihcclxuICAgIGAjJHtpbnB1dEVsZW1lbnQuaWR9LWVycm9yYFxyXG4gICk7XHJcblxyXG4gIGlmICghZXJyb3JNZXNzYWdlRWxlbWVudCkge1xyXG4gICAgbG9nRXJyb3IoYEVycm9yIG1lc3NhZ2UgZWxlbWVudCBmb3IgaW5wdXQgJHtpbnB1dEVsZW1lbnQuaWR9IG5vdCBmb3VuZC5gKTtcclxuICAgIHJldHVybjtcclxuICB9XHJcblxyXG4gIGVycm9yTWVzc2FnZUVsZW1lbnQudGV4dENvbnRlbnQgPSBcIlwiO1xyXG4gIGVycm9yTWVzc2FnZUVsZW1lbnQucmVtb3ZlQXR0cmlidXRlKFwicm9sZVwiKTtcclxuICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShjb25maWcuaW5wdXRFcnJvckNsYXNzKTtcclxufTtcclxuXHJcbi8vIENoZWNrIGlucHV0IHZhbGlkaXR5XHJcbmNvbnN0IGNoZWNrSW5wdXRWYWxpZGl0eSA9IChmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBjb25maWcpID0+IHtcclxuICBpZiAoIWlucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZCkge1xyXG4gICAgc2hvd0lucHV0RXJyb3IoXHJcbiAgICAgIGZvcm1FbGVtZW50LFxyXG4gICAgICBpbnB1dEVsZW1lbnQsXHJcbiAgICAgIGlucHV0RWxlbWVudC52YWxpZGF0aW9uTWVzc2FnZSxcclxuICAgICAgY29uZmlnXHJcbiAgICApO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBoaWRlSW5wdXRFcnJvcihmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBjb25maWcpO1xyXG4gIH1cclxufTtcclxuXHJcbi8vIENoZWNrIGlmIGZvcm0gaGFzIGludmFsaWQgaW5wdXRcclxuY29uc3QgaGFzSW52YWxpZElucHV0ID0gKGlucHV0TGlzdCkgPT4ge1xyXG4gIHJldHVybiBpbnB1dExpc3Quc29tZSgoaW5wdXQpID0+ICFpbnB1dC52YWxpZGl0eS52YWxpZCk7XHJcbn07XHJcblxyXG4vLyBUb2dnbGUgYnV0dG9uIHN0YXRlXHJcbmNvbnN0IHRvZ2dsZUJ1dHRvblN0YXRlID0gKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgY29uZmlnKSA9PiB7XHJcbiAgaWYgKGhhc0ludmFsaWRJbnB1dChpbnB1dExpc3QpKSB7XHJcbiAgICBkaXNhYmxlQnV0dG9uKGJ1dHRvbkVsZW1lbnQsIGNvbmZpZyk7XHJcbiAgfSBlbHNlIHtcclxuICAgIGJ1dHRvbkVsZW1lbnQuZGlzYWJsZWQgPSBmYWxzZTtcclxuICAgIGJ1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShjb25maWcuaW5hY3RpdmVCdXR0b25DbGFzcyk7XHJcbiAgfVxyXG59O1xyXG5cclxuLy8gRGlzYWJsZSBidXR0b25cclxuY29uc3QgZGlzYWJsZUJ1dHRvbiA9IChidXR0b25FbGVtZW50LCBjb25maWcpID0+IHtcclxuICBidXR0b25FbGVtZW50LmRpc2FibGVkID0gdHJ1ZTtcclxuICBidXR0b25FbGVtZW50LmNsYXNzTGlzdC5hZGQoY29uZmlnLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xyXG59O1xyXG5cclxuLy8gUmVzZXQgdmFsaWRhdGlvblxyXG5leHBvcnQgY29uc3QgcmVzZXRWYWxpZGF0aW9uID0gKGZvcm1FbGVtZW50LCBpbnB1dExpc3QsIGNvbmZpZykgPT4ge1xyXG4gIGlucHV0TGlzdC5mb3JFYWNoKChpbnB1dCkgPT4ge1xyXG4gICAgaGlkZUlucHV0RXJyb3IoZm9ybUVsZW1lbnQsIGlucHV0LCBjb25maWcpO1xyXG4gIH0pO1xyXG5cclxuICBjb25zdCBidXR0b25FbGVtZW50ID0gZm9ybUVsZW1lbnQucXVlcnlTZWxlY3Rvcihjb25maWcuc3VibWl0QnV0dG9uU2VsZWN0b3IpO1xyXG4gIGRpc2FibGVCdXR0b24oYnV0dG9uRWxlbWVudCwgY29uZmlnKTsgLy8gRGlzYWJsZSB0aGUgYnV0dG9uIGR1cmluZyByZXNldFxyXG59O1xyXG5cclxuLy8gQWRkIGV2ZW50IGxpc3RlbmVycyB0byB0aGUgZm9ybVxyXG5jb25zdCBzZXRFdmVudExpc3RlbmVycyA9IChmb3JtRWxlbWVudCwgY29uZmlnKSA9PiB7XHJcbiAgY29uc3QgaW5wdXRMaXN0ID0gQXJyYXkuZnJvbShcclxuICAgIGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoY29uZmlnLmlucHV0U2VsZWN0b3IpXHJcbiAgKTtcclxuICBjb25zdCBidXR0b25FbGVtZW50ID0gZm9ybUVsZW1lbnQucXVlcnlTZWxlY3Rvcihjb25maWcuc3VibWl0QnV0dG9uU2VsZWN0b3IpO1xyXG5cclxuICB0b2dnbGVCdXR0b25TdGF0ZShpbnB1dExpc3QsIGJ1dHRvbkVsZW1lbnQsIGNvbmZpZyk7IC8vIEluaXRpYWwgYnV0dG9uIHN0YXRlIGNoZWNrXHJcblxyXG4gIGlucHV0TGlzdC5mb3JFYWNoKChpbnB1dEVsZW1lbnQpID0+IHtcclxuICAgIGlucHV0RWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgKCkgPT4ge1xyXG4gICAgICBjaGVja0lucHV0VmFsaWRpdHkoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgY29uZmlnKTtcclxuICAgICAgdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbGVtZW50LCBjb25maWcpOyAvLyBVcGRhdGUgYnV0dG9uIHN0YXRlIG9uIGlucHV0XHJcbiAgICB9KTtcclxuICB9KTtcclxufTtcclxuXHJcbi8vIEVuYWJsZSB2YWxpZGF0aW9uIGZvciBhbGwgZm9ybXNcclxuZXhwb3J0IGNvbnN0IGVuYWJsZVZhbGlkYXRpb24gPSAoY29uZmlnKSA9PiB7XHJcbiAgY29uc3QgZm9ybUxpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGNvbmZpZy5mb3JtU2VsZWN0b3IpO1xyXG5cclxuICBmb3JtTGlzdC5mb3JFYWNoKChmb3JtRWxlbWVudCkgPT4ge1xyXG4gICAgY29uc3QgaW5wdXRMaXN0ID0gQXJyYXkuZnJvbShcclxuICAgICAgZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbChjb25maWcuaW5wdXRTZWxlY3RvcilcclxuICAgICk7XHJcbiAgICBzZXRFdmVudExpc3RlbmVycyhmb3JtRWxlbWVudCwgY29uZmlnKTtcclxuXHJcbiAgICAvLyBDbGVhciB2YWxpZGF0aW9uIG9uIGZvcm0gcmVzZXRcclxuICAgIGZvcm1FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJyZXNldFwiLCAoKSA9PiB7XHJcbiAgICAgIHJlc2V0VmFsaWRhdGlvbihmb3JtRWxlbWVudCwgaW5wdXRMaXN0LCBjb25maWcpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn07XHJcbiIsImV4cG9ydCBmdW5jdGlvbiByZW5kZXJMb2FkaW5nKFxyXG4gIGlzTG9hZGluZyxcclxuICBidXR0b24sXHJcbiAgYnV0dG9uVGV4dCA9IFwiU2F2ZVwiLFxyXG4gIGxvYWRpbmdUZXh0ID0gXCJTYXZpbmcuLi5cIlxyXG4pIHtcclxuICBpZiAoaXNMb2FkaW5nKSB7XHJcbiAgICBidXR0b24udGV4dENvbnRlbnQgPSBsb2FkaW5nVGV4dDtcclxuICB9IGVsc2Uge1xyXG4gICAgYnV0dG9uLnRleHRDb250ZW50ID0gYnV0dG9uVGV4dDtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBoYW5kbGVTdWJtaXQocmVxdWVzdCwgZXZ0LCBsb2FkaW5nVGV4dCA9IFwiU2F2aW5nLi4uXCIpIHtcclxuICBldnQucHJldmVudERlZmF1bHQoKTtcclxuICBjb25zdCBzdWJtaXRCdXR0b24gPSBldnQuc3VibWl0dGVyO1xyXG4gIGNvbnN0IGluaXRpYWxUZXh0ID0gc3VibWl0QnV0dG9uLnRleHRDb250ZW50O1xyXG5cclxuICByZW5kZXJMb2FkaW5nKHRydWUsIHN1Ym1pdEJ1dHRvbiwgaW5pdGlhbFRleHQsIGxvYWRpbmdUZXh0KTtcclxuXHJcbiAgcmV0dXJuIHJlcXVlc3QoKVxyXG4gICAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpXHJcbiAgICAuZmluYWxseSgoKSA9PiB7XHJcbiAgICAgIHJlbmRlckxvYWRpbmcoZmFsc2UsIHN1Ym1pdEJ1dHRvbiwgaW5pdGlhbFRleHQpO1xyXG4gICAgfSk7XHJcbn1cclxuIiwiLy8gRXJyb3IgaGFuZGxlciB1dGlsaXR5IGZvciB1c2VyLWZhY2luZyBlcnJvciBtZXNzYWdlc1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHNob3dFcnJvck1lc3NhZ2UobWVzc2FnZSwgZHVyYXRpb24gPSA1MDAwKSB7XHJcbiAgLy8gQ3JlYXRlIGVycm9yIG5vdGlmaWNhdGlvbiBlbGVtZW50XHJcbiAgY29uc3QgZXJyb3JEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICBlcnJvckRpdi5jbGFzc05hbWUgPSAnZXJyb3Itbm90aWZpY2F0aW9uJztcclxuICBlcnJvckRpdi50ZXh0Q29udGVudCA9IG1lc3NhZ2U7XHJcbiAgZXJyb3JEaXYuc2V0QXR0cmlidXRlKCdyb2xlJywgJ2FsZXJ0Jyk7XHJcbiAgZXJyb3JEaXYuc2V0QXR0cmlidXRlKCdhcmlhLWxpdmUnLCAncG9saXRlJyk7XHJcbiAgXHJcbiAgLy8gQWRkIHRvIERPTVxyXG4gIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZXJyb3JEaXYpO1xyXG4gIFxyXG4gIC8vIEF1dG8tcmVtb3ZlIGFmdGVyIGR1cmF0aW9uXHJcbiAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICBpZiAoZXJyb3JEaXYucGFyZW50Tm9kZSkge1xyXG4gICAgICBlcnJvckRpdi5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGVycm9yRGl2KTtcclxuICAgIH1cclxuICB9LCBkdXJhdGlvbik7XHJcbiAgXHJcbiAgcmV0dXJuIGVycm9yRGl2O1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gaGFuZGxlQXBpRXJyb3IoZXJyb3IpIHtcclxuICBsZXQgdXNlck1lc3NhZ2UgPSAnU29tZXRoaW5nIHdlbnQgd3JvbmcuIFBsZWFzZSB0cnkgYWdhaW4uJztcclxuICBcclxuICAvLyBQYXJzZSBkaWZmZXJlbnQgZXJyb3IgdHlwZXNcclxuICBpZiAodHlwZW9mIGVycm9yID09PSAnc3RyaW5nJyAmJiBlcnJvci5pbmNsdWRlcygnRXJyb3I6ICcpKSB7XHJcbiAgICBjb25zdCBzdGF0dXNDb2RlID0gZXJyb3IubWF0Y2goL0Vycm9yOiAoXFxkKykvKT8uWzFdO1xyXG4gICAgXHJcbiAgICBzd2l0Y2ggKHN0YXR1c0NvZGUpIHtcclxuICAgICAgY2FzZSAnNDAwJzpcclxuICAgICAgICB1c2VyTWVzc2FnZSA9ICdJbnZhbGlkIHJlcXVlc3QuIFBsZWFzZSBjaGVjayB5b3VyIGlucHV0Lic7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJzQwMSc6XHJcbiAgICAgICAgdXNlck1lc3NhZ2UgPSAnQXV0aGVudGljYXRpb24gZmFpbGVkLiBQbGVhc2UgcmVmcmVzaCBhbmQgdHJ5IGFnYWluLic7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJzQwMyc6XHJcbiAgICAgICAgdXNlck1lc3NhZ2UgPSAnWW91IGRvIG5vdCBoYXZlIHBlcm1pc3Npb24gdG8gcGVyZm9ybSB0aGlzIGFjdGlvbi4nO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlICc0MDQnOlxyXG4gICAgICAgIHVzZXJNZXNzYWdlID0gJ1RoZSByZXF1ZXN0ZWQgcmVzb3VyY2Ugd2FzIG5vdCBmb3VuZC4nO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlICc1MDAnOlxyXG4gICAgICAgIHVzZXJNZXNzYWdlID0gJ1NlcnZlciBlcnJvci4gUGxlYXNlIHRyeSBhZ2FpbiBsYXRlci4nO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBkZWZhdWx0OlxyXG4gICAgICAgIHVzZXJNZXNzYWdlID0gYFJlcXVlc3QgZmFpbGVkICgke3N0YXR1c0NvZGV9KS4gUGxlYXNlIHRyeSBhZ2Fpbi5gO1xyXG4gICAgfVxyXG4gIH0gZWxzZSBpZiAoZXJyb3IgaW5zdGFuY2VvZiBUeXBlRXJyb3IpIHtcclxuICAgIHVzZXJNZXNzYWdlID0gJ05ldHdvcmsgZXJyb3IuIFBsZWFzZSBjaGVjayB5b3VyIGNvbm5lY3Rpb24uJztcclxuICB9XHJcbiAgXHJcbiAgLy8gTG9nIHRlY2huaWNhbCBlcnJvciBmb3IgZGVidWdnaW5nXHJcbiAgY29uc29sZS5lcnJvcignQVBJIEVycm9yOicsIGVycm9yKTtcclxuICBcclxuICAvLyBTaG93IHVzZXItZnJpZW5kbHkgbWVzc2FnZVxyXG4gIHNob3dFcnJvck1lc3NhZ2UodXNlck1lc3NhZ2UpO1xyXG4gIFxyXG4gIHJldHVybiB1c2VyTWVzc2FnZTtcclxufSIsIi8vIENvbmZpZ3VyYXRpb24gZmlsZSBmb3IgZW52aXJvbm1lbnQgdmFyaWFibGVzXHJcblxyXG5leHBvcnQgY29uc3QgY29uZmlnID0ge1xyXG4gIGFwaUJhc2VVcmw6IHByb2Nlc3MuZW52LkFQSV9CQVNFX1VSTCB8fCBcImh0dHBzOi8vYXJvdW5kLWFwaS5lbi50cmlwbGV0ZW4tc2VydmljZXMuY29tL3YxXCIsXHJcbiAgYXBpVG9rZW46IHByb2Nlc3MuZW52LkFQSV9UT0tFTiB8fCBcImYxZjFkYmFiLThlMTctNDhkMy1hMDk4LWQ3N2RmZDZlYTNjNVwiLCAvLyBmYWxsYmFjayBmb3IgZGV2ZWxvcG1lbnRcclxufTsiLCJpbXBvcnQgXCIuL2luZGV4LmNzc1wiOyAvLyBJbXBvcnRpbmcgdGhlIENTUyBmaWxlXHJcbmltcG9ydCB7XHJcbiAgZW5hYmxlVmFsaWRhdGlvbixcclxuICBzZXR0aW5ncyxcclxuICByZXNldFZhbGlkYXRpb24sXHJcbn0gZnJvbSBcIi4uL3NjcmlwdHMvdmFsaWRhdGlvbi5qc1wiOyAvLyBJbXBvcnRpbmcgdmFsaWRhdGlvbiBmdW5jdGlvbnNcclxuaW1wb3J0IEFwaSBmcm9tIFwiLi4vdXRpbHMvQXBpLmpzXCI7IC8vIEltcG9ydGluZyB0aGUgQVBJIGNsYXNzXHJcbmltcG9ydCB7IGhhbmRsZVN1Ym1pdCwgcmVuZGVyTG9hZGluZyB9IGZyb20gXCIuLi91dGlscy91dGlscy5qc1wiOyAvLyBJbXBvcnRpbmcgdXRpbGl0eSBmdW5jdGlvbnNcclxuaW1wb3J0IHsgaGFuZGxlQXBpRXJyb3IgfSBmcm9tIFwiLi4vdXRpbHMvZXJyb3JIYW5kbGVyLmpzXCI7IC8vIEltcG9ydGluZyBlcnJvciBoYW5kbGVyXHJcbmltcG9ydCB7IGNvbmZpZyB9IGZyb20gXCIuLi91dGlscy9jb25maWcuanNcIjsgLy8gSW1wb3J0aW5nIGNvbmZpZ3VyYXRpb25cclxuXHJcbi8vIEltcG9ydGluZyBpbWFnZXMgYW5kIG90aGVyIGFzc2V0c1xyXG5pbXBvcnQgbG9nb1BhdGggZnJvbSBcIi4uL2ltYWdlcy9sb2dvLnN2Z1wiO1xyXG5pbXBvcnQgYXZhdGFyUGF0aCBmcm9tIFwiLi4vaW1hZ2VzL2F2YXRhci5qcGdcIjtcclxuaW1wb3J0IGVkaXRCdXR0b25QYXRoIGZyb20gXCIuLi9pbWFnZXMvZWRpdGJ0bi5zdmdcIjtcclxuaW1wb3J0IGFkZEJ1dHRvblBhdGggZnJvbSBcIi4uL2ltYWdlcy9hZGRidG4uc3ZnXCI7XHJcbmltcG9ydCBlZGl0TGlnaHRCdXR0b25QYXRoIGZyb20gXCIuLi9pbWFnZXMvZWRpdGJ0bi1saWdodC5zdmdcIjtcclxuXHJcbi8vIFNldCBpbWFnZSBzb3VyY2VzIHdpdGggbnVsbCBjaGVja3NcclxuY29uc3QgaGVhZGVyTG9nbyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuaGVhZGVyX19sb2dvXCIpO1xyXG5jb25zdCBwcm9maWxlQXZhdGFyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hdmF0YXJcIik7XHJcbmNvbnN0IGVkaXRCdXR0b25JbWcgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2VkaXQtYnV0dG9uIGltZ1wiKTtcclxuY29uc3QgYWRkQnV0dG9uSW1nID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hZGQtYnV0dG9uIGltZ1wiKTtcclxuY29uc3QgcGVuY2lsSWNvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fcGVuY2lsSWNvblwiKTtcclxuXHJcbmlmIChoZWFkZXJMb2dvKSBoZWFkZXJMb2dvLnNyYyA9IGxvZ29QYXRoO1xyXG5pZiAocHJvZmlsZUF2YXRhcikgcHJvZmlsZUF2YXRhci5zcmMgPSBhdmF0YXJQYXRoO1xyXG5pZiAoZWRpdEJ1dHRvbkltZykgZWRpdEJ1dHRvbkltZy5zcmMgPSBlZGl0QnV0dG9uUGF0aDtcclxuaWYgKGFkZEJ1dHRvbkltZykgYWRkQnV0dG9uSW1nLnNyYyA9IGFkZEJ1dHRvblBhdGg7XHJcbmlmIChwZW5jaWxJY29uKSBwZW5jaWxJY29uLnNyYyA9IGVkaXRMaWdodEJ1dHRvblBhdGg7XHJcblxyXG5jb25zdCBhcGkgPSBuZXcgQXBpKHtcclxuICBiYXNlVXJsOiBjb25maWcuYXBpQmFzZVVybCxcclxuICBoZWFkZXJzOiB7XHJcbiAgICBhdXRob3JpemF0aW9uOiBjb25maWcuYXBpVG9rZW4sXHJcbiAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcclxuICB9LFxyXG59KTtcclxuXHJcbmxldCB1c2VySWQ7XHJcblxyXG5hcGlcclxuICAuZ2V0VXNlckluZm8oKVxyXG4gIC50aGVuKCh1c2VyRGF0YSkgPT4ge1xyXG4gICAgdXNlcklkID0gdXNlckRhdGEuX2lkO1xyXG4gICAgaWYgKHByb2ZpbGVOYW1lKSBwcm9maWxlTmFtZS50ZXh0Q29udGVudCA9IHVzZXJEYXRhLm5hbWU7XHJcbiAgICBpZiAocHJvZmlsZURlc2NyaXB0aW9uKSBwcm9maWxlRGVzY3JpcHRpb24udGV4dENvbnRlbnQgPSB1c2VyRGF0YS5hYm91dDtcclxuICAgIGlmIChwcm9maWxlQXZhdGFyRWxlbWVudCkgcHJvZmlsZUF2YXRhckVsZW1lbnQuc3JjID0gdXNlckRhdGEuYXZhdGFyO1xyXG4gICAgcmV0dXJuIGFwaS5nZXRJbml0aWFsQ2FyZHMoKTtcclxuICB9KVxyXG4gIC50aGVuKChjYXJkcykgPT4ge1xyXG4gICAgaWYgKGNhcmRzTGlzdCAmJiBBcnJheS5pc0FycmF5KGNhcmRzKSkge1xyXG4gICAgICBjYXJkcy5mb3JFYWNoKChjYXJkKSA9PiB7XHJcbiAgICAgICAgY29uc3QgY2FyZEVsZW1lbnQgPSBnZXRDYXJkRWxlbWVudChjYXJkKTtcclxuICAgICAgICBpZiAoY2FyZEVsZW1lbnQpIHtcclxuICAgICAgICAgIGNhcmRzTGlzdC5hcHBlbmQoY2FyZEVsZW1lbnQpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb25zb2xlLmVycm9yKFwiQ2FyZHMgbGlzdCBlbGVtZW50IG5vdCBmb3VuZCBvciBjYXJkcyBkYXRhIGlzIGludmFsaWRcIik7XHJcbiAgICB9XHJcbiAgfSlcclxuICAuY2F0Y2goaGFuZGxlQXBpRXJyb3IpO1xyXG5cclxuLy8gUHJvZmlsZSBTZWxlY3RvcnMgd2l0aCBudWxsIGNoZWNrc1xyXG5jb25zdCBlZGl0TW9kYWxCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2VkaXQtYnV0dG9uXCIpO1xyXG5jb25zdCBjYXJkTW9kYWxCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2FkZC1idXR0b25cIik7XHJcbmNvbnN0IHByb2ZpbGVOYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19uYW1lXCIpO1xyXG5jb25zdCBwcm9maWxlRGVzY3JpcHRpb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2Rlc2NyaXB0aW9uXCIpO1xyXG5cclxuLy8gTW9kYWwgU2VsZWN0b3JzIHdpdGggbnVsbCBjaGVja3NcclxuY29uc3QgY2xvc2VCdXR0b25zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5tb2RhbF9fY2xvc2UtYnV0dG9uXCIpO1xyXG5jb25zdCBkZWxldGVNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZGVsZXRlLW1vZGFsXCIpO1xyXG5jb25zdCBkZWxldGVGb3JtID0gZGVsZXRlTW9kYWw/LnF1ZXJ5U2VsZWN0b3IoXCIjZGVsZXRlLWZvcm1cIik7XHJcbmNvbnN0IGNhbmNlbERlbGV0ZUJ1dHRvbiA9IGRlbGV0ZU1vZGFsPy5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jYW5jZWwtYnV0dG9uXCIpO1xyXG5jb25zdCBhdmF0YXJFZGl0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hdmF0YXItYnV0dG9uXCIpO1xyXG5jb25zdCBhdmF0YXJNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbmV3LWF2YXRhci1tb2RhbFwiKTtcclxuY29uc3QgYXZhdGFyRm9ybSA9IGF2YXRhck1vZGFsPy5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtXCIpO1xyXG5jb25zdCBhdmF0YXJMaW5rSW5wdXQgPSBhdmF0YXJNb2RhbD8ucXVlcnlTZWxlY3RvcihcIiNuZXctYXZhdGFyLWxpbmstaW5wdXRcIik7XHJcbmNvbnN0IHByb2ZpbGVBdmF0YXJFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hdmF0YXJcIik7XHJcblxyXG4vLyBNb2RhbCAtIEVkaXQgUHJvZmlsZVxyXG5jb25zdCBlZGl0TW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2VkaXQtbW9kYWxcIik7XHJcbmNvbnN0IGVkaXRGb3JtID0gZWRpdE1vZGFsPy5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtXCIpO1xyXG5jb25zdCBlZGl0TW9kYWxOYW1lSW5wdXQgPSBlZGl0TW9kYWw/LnF1ZXJ5U2VsZWN0b3IoXCIjcHJvZmlsZS1uYW1lLWlucHV0XCIpO1xyXG5jb25zdCBlZGl0TW9kYWxEZXNjcmlwdGlvbklucHV0ID0gZWRpdE1vZGFsPy5xdWVyeVNlbGVjdG9yKFxyXG4gIFwiI3Byb2ZpbGUtZGVzY3JpcHRpb24taW5wdXRcIlxyXG4pO1xyXG5cclxuLy8gTW9kYWwgLSBBZGQgQ2FyZFxyXG5jb25zdCBjYXJkTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI25ldy1jYXJkLW1vZGFsXCIpO1xyXG5jb25zdCBjYXJkRm9ybSA9IGNhcmRNb2RhbD8ucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fZm9ybVwiKTtcclxuY29uc3QgY2FyZExpbmtJbnB1dCA9IGNhcmRNb2RhbD8ucXVlcnlTZWxlY3RvcihcIiNuZXctY2FyZC1saW5rLWlucHV0XCIpO1xyXG5jb25zdCBjYXJkQ2FwdGlvbklucHV0ID0gY2FyZE1vZGFsPy5xdWVyeVNlbGVjdG9yKFwiI25ldy1jYXJkLWNhcHRpb24taW5wdXRcIik7XHJcblxyXG4vLyBNb2RhbCBQcmV2aWV3XHJcbmNvbnN0IHByZXZpZXdNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcHJldmlldy1tb2RhbFwiKTtcclxuY29uc3QgcHJldmlld0ltYWdlID0gcHJldmlld01vZGFsPy5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19pbWFnZVwiKTtcclxuY29uc3QgcHJldmlld0NhcHRpb24gPSBwcmV2aWV3TW9kYWw/LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2NhcHRpb25cIik7XHJcblxyXG4vLyBDYXJkc1xyXG5jb25zdCBjYXJkVGVtcGxhdGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2NhcmQtdGVtcGxhdGVcIik7XHJcbmNvbnN0IGNhcmRzTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZHNfX2xpc3RcIik7XHJcblxyXG5mdW5jdGlvbiBnZXRDYXJkRWxlbWVudChkYXRhKSB7XHJcbiAgaWYgKCFjYXJkVGVtcGxhdGUpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoXCJDYXJkIHRlbXBsYXRlIG5vdCBmb3VuZFwiKTtcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxuICBcclxuICBjb25zdCBjYXJkRWxlbWVudCA9IGNhcmRUZW1wbGF0ZS5jb250ZW50XHJcbiAgICAucXVlcnlTZWxlY3RvcihcIi5jYXJkXCIpXHJcbiAgICAuY2xvbmVOb2RlKHRydWUpO1xyXG4gIGNhcmRFbGVtZW50Ll9pZCA9IGRhdGEuX2lkO1xyXG5cclxuICBjb25zdCBjYXJkVGl0bGUgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX3RpdGxlXCIpO1xyXG4gIGNvbnN0IGNhcmRJbWFnZSA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9faW1hZ2VcIik7XHJcbiAgY29uc3QgY2FyZExpa2VCdXR0b24gPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2xpa2UtYnV0dG9uXCIpO1xyXG4gIGNvbnN0IGNhcmRMaWtlQ291bnQgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2xpa2UtY291bnRcIik7XHJcbiAgY29uc3QgY2FyZERlbGV0ZUJ1dHRvbiA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fZGVsZXRlLWJ1dHRvblwiKTtcclxuXHJcbiAgLy8gU2V0IGNhcmQgZGF0YSB3aXRoIG51bGwgY2hlY2tzXHJcbiAgaWYgKGNhcmRUaXRsZSkgY2FyZFRpdGxlLnRleHRDb250ZW50ID0gZGF0YS5uYW1lO1xyXG4gIGlmIChjYXJkSW1hZ2UpIHtcclxuICAgIGNhcmRJbWFnZS5zcmMgPSBkYXRhLmxpbms7XHJcbiAgICBjYXJkSW1hZ2UuYWx0ID0gZGF0YS5uYW1lO1xyXG4gICAgXHJcbiAgICAvLyBBZGQgZXJyb3IgaGFuZGxpbmcgZm9yIGZhaWxlZCBpbWFnZSBsb2Fkc1xyXG4gICAgY2FyZEltYWdlLm9uZXJyb3IgPSBmdW5jdGlvbigpIHtcclxuICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBsb2FkIGltYWdlOlwiLCBkYXRhLmxpbmspO1xyXG4gICAgICB0aGlzLnNyYyA9IFwiZGF0YTppbWFnZS9zdmcreG1sLCUzQ3N2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPScxMDAnIGhlaWdodD0nMTAwJyUzRSUzQ3JlY3Qgd2lkdGg9JzEwMCcgaGVpZ2h0PScxMDAnIGZpbGw9JyUyM2YwZjBmMCcvJTNFJTNDdGV4dCB4PSc1MCcgeT0nNTAnIHRleHQtYW5jaG9yPSdtaWRkbGUnIGR5PScuM2VtJyUzRUltYWdlIG5vdCBmb3VuZCUzQy90ZXh0JTNFJTNDL3N2ZyUzRVwiO1xyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIC8vIFNldCBpbml0aWFsIGxpa2Ugc3RhdGUgYW5kIGNvdW50IC0gdXNlIGFjdHVhbCBsaWtlcyBhcnJheSBsZW5ndGhcclxuICBjb25zdCBsaWtlc0NvdW50ID0gZGF0YS5saWtlcyA/IGRhdGEubGlrZXMubGVuZ3RoIDogMDtcclxuICBjb25zdCBpc0xpa2VkQnlVc2VyID0gZGF0YS5saWtlcyAmJiBkYXRhLmxpa2VzLnNvbWUobGlrZSA9PiBsaWtlLl9pZCA9PT0gdXNlcklkKTtcclxuICBcclxuICBpZiAoY2FyZExpa2VDb3VudCkgY2FyZExpa2VDb3VudC50ZXh0Q29udGVudCA9IGxpa2VzQ291bnQudG9TdHJpbmcoKTtcclxuICBpZiAoY2FyZExpa2VCdXR0b24gJiYgaXNMaWtlZEJ5VXNlcikge1xyXG4gICAgY2FyZExpa2VCdXR0b24uY2xhc3NMaXN0LmFkZChcImNhcmRfX2xpa2UtYnV0dG9uX2xpa2VkXCIpO1xyXG4gIH1cclxuXHJcbiAgY2FyZExpa2VCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICAgIGNvbnN0IGlzQ3VycmVudGx5TGlrZWQgPSBjYXJkTGlrZUJ1dHRvbi5jbGFzc0xpc3QuY29udGFpbnMoXHJcbiAgICAgIFwiY2FyZF9fbGlrZS1idXR0b25fbGlrZWRcIlxyXG4gICAgKTtcclxuXHJcbiAgICBjb25zdCBsaWtlQ2FyZFByb21pc2UgPSBpc0N1cnJlbnRseUxpa2VkXHJcbiAgICAgID8gYXBpLmRpc2xpa2VDYXJkKGRhdGEuX2lkKVxyXG4gICAgICA6IGFwaS5saWtlQ2FyZChkYXRhLl9pZCk7XHJcblxyXG4gICAgbGlrZUNhcmRQcm9taXNlXHJcbiAgICAgIC50aGVuKCh1cGRhdGVkQ2FyZCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGlzTGlrZWQgPSB1cGRhdGVkQ2FyZC5saWtlcyAmJiB1cGRhdGVkQ2FyZC5saWtlcy5zb21lKGxpa2UgPT4gbGlrZS5faWQgPT09IHVzZXJJZCk7XHJcbiAgICAgICAgY29uc3QgbGlrZXNDb3VudCA9IHVwZGF0ZWRDYXJkLmxpa2VzID8gdXBkYXRlZENhcmQubGlrZXMubGVuZ3RoIDogMDtcclxuICAgICAgICBcclxuICAgICAgICBjYXJkTGlrZUJ1dHRvbi5jbGFzc0xpc3QudG9nZ2xlKFwiY2FyZF9fbGlrZS1idXR0b25fbGlrZWRcIiwgaXNMaWtlZCk7XHJcbiAgICAgICAgY2FyZExpa2VDb3VudC50ZXh0Q29udGVudCA9IGxpa2VzQ291bnQudG9TdHJpbmcoKTtcclxuICAgICAgfSlcclxuICAgICAgLmNhdGNoKChlcnJvcikgPT4ge1xyXG4gICAgICAgIGhhbmRsZUFwaUVycm9yKGVycm9yKTtcclxuICAgICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIC8vIGRlbGV0ZSBhbmQgcHJldmlldyBldmVudCBsaXN0ZW5lcnNcclxuICBjYXJkRGVsZXRlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgICBvcGVuTW9kYWwoZGVsZXRlTW9kYWwpO1xyXG4gICAgZGVsZXRlRm9ybS5fY2FyZFRvRGVsZXRlID0gY2FyZEVsZW1lbnQ7XHJcbiAgfSk7XHJcblxyXG4gIGNhcmRJbWFnZS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gICAgb3Blbk1vZGFsKHByZXZpZXdNb2RhbCk7XHJcbiAgICBwcmV2aWV3Q2FwdGlvbi50ZXh0Q29udGVudCA9IGRhdGEubmFtZTtcclxuICAgIHByZXZpZXdJbWFnZS5hbHQgPSBkYXRhLm5hbWU7XHJcbiAgICBwcmV2aWV3SW1hZ2Uuc3JjID0gZGF0YS5saW5rO1xyXG4gIH0pO1xyXG5cclxuICByZXR1cm4gY2FyZEVsZW1lbnQ7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIG9wZW5Nb2RhbChtb2RhbCkge1xyXG4gIG1vZGFsLmNsYXNzTGlzdC5hZGQoXCJtb2RhbF9vcGVuZWRcIik7XHJcblxyXG4gIC8vIFJlbW92ZSBleGlzdGluZyBsaXN0ZW5lcnMgdG8gcHJldmVudCBkdXBsaWNhdGVzXHJcbiAgaWYgKG1vZGFsLl9oYW5kbGVPdmVybGF5Q2xpY2spIHtcclxuICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBtb2RhbC5faGFuZGxlT3ZlcmxheUNsaWNrKTtcclxuICB9XHJcbiAgaWYgKG1vZGFsLl9oYW5kbGVFc2NhcGVLZXlQcmVzcykge1xyXG4gICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgbW9kYWwuX2hhbmRsZUVzY2FwZUtleVByZXNzKTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIGhhbmRsZU92ZXJsYXlDbGljayhldmVudCkge1xyXG4gICAgaWYgKGV2ZW50LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJtb2RhbF9vcGVuZWRcIikpIHtcclxuICAgICAgY2xvc2VNb2RhbChtb2RhbCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBoYW5kbGVFc2NhcGVLZXlQcmVzcyhldmVudCkge1xyXG4gICAgaWYgKGV2ZW50LmtleSA9PT0gXCJFc2NhcGVcIikge1xyXG4gICAgICBjbG9zZU1vZGFsKG1vZGFsKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIFN0b3JlIHJlZmVyZW5jZXMgYW5kIGFkZCBuZXcgbGlzdGVuZXJzXHJcbiAgbW9kYWwuX2hhbmRsZU92ZXJsYXlDbGljayA9IGhhbmRsZU92ZXJsYXlDbGljaztcclxuICBtb2RhbC5faGFuZGxlRXNjYXBlS2V5UHJlc3MgPSBoYW5kbGVFc2NhcGVLZXlQcmVzcztcclxuICBcclxuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgaGFuZGxlT3ZlcmxheUNsaWNrKTtcclxuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBoYW5kbGVFc2NhcGVLZXlQcmVzcyk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNsb3NlTW9kYWwobW9kYWwpIHtcclxuICBtb2RhbC5jbGFzc0xpc3QucmVtb3ZlKFwibW9kYWxfb3BlbmVkXCIpO1xyXG5cclxuICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgbW9kYWwuX2hhbmRsZU92ZXJsYXlDbGljayk7XHJcbiAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgbW9kYWwuX2hhbmRsZUVzY2FwZUtleVByZXNzKTtcclxufVxyXG5cclxuLy8gZnVuY3Rpb24gcmVuZGVyTG9hZGluZyhcclxuLy8gaXNMb2FkaW5nLFxyXG4vLyBidXR0b24sXHJcbi8vIGJ1dHRvblRleHQgPSBcIlNhdmVcIixcclxuLy8gbG9hZGluZ1RleHQgPSBcIlNhdmluZy4uLlwiXHJcbi8vICkge1xyXG4vLyBidXR0b24udGV4dENvbnRlbnQgPSBpc0xvYWRpbmcgPyBsb2FkaW5nVGV4dCA6IGJ1dHRvblRleHQ7XHJcbi8vIH1cclxuXHJcbi8vIFVuaXZlcnNhbCBDbG9zZSBCdXR0b24gSGFuZGxlclxyXG5jbG9zZUJ1dHRvbnMuZm9yRWFjaCgoYnV0dG9uKSA9PiB7XHJcbiAgY29uc3QgbW9kYWwgPSBidXR0b24uY2xvc2VzdChcIi5tb2RhbFwiKTtcclxuICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IGNsb3NlTW9kYWwobW9kYWwpKTtcclxufSk7XHJcblxyXG4vLyBIYW5kbGVyc1xyXG5mdW5jdGlvbiBtYWtlRWRpdFByb2ZpbGVSZXF1ZXN0KCkge1xyXG4gIC8vIEdldCBmb3JtIHZhbHVlc1xyXG4gIGNvbnN0IG5hbWUgPSBlZGl0TW9kYWxOYW1lSW5wdXQudmFsdWU7XHJcbiAgY29uc3QgYWJvdXQgPSBlZGl0TW9kYWxEZXNjcmlwdGlvbklucHV0LnZhbHVlO1xyXG5cclxuICAvLyBNYWtlIEFQSSBjYWxsIHRvIGVkaXQgdXNlciBpbmZvXHJcbiAgcmV0dXJuIGFwaS5lZGl0VXNlckluZm8oeyBuYW1lLCBhYm91dCB9KS50aGVuKCh1c2VyRGF0YSkgPT4ge1xyXG4gICAgLy8gVXBkYXRlIHRoZSBET00gd2l0aCB0aGUgbmV3IHVzZXIgZGF0YVxyXG4gICAgcHJvZmlsZU5hbWUudGV4dENvbnRlbnQgPSB1c2VyRGF0YS5uYW1lO1xyXG4gICAgcHJvZmlsZURlc2NyaXB0aW9uLnRleHRDb250ZW50ID0gdXNlckRhdGEuYWJvdXQ7XHJcbiAgICAvLyBDbG9zZSB0aGUgbW9kYWxcclxuICAgIGNsb3NlTW9kYWwoZWRpdE1vZGFsKTtcclxuICB9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gaGFuZGxlRWRpdEZvcm1TdWJtaXQoZXZ0KSB7XHJcbiAgaGFuZGxlU3VibWl0KG1ha2VFZGl0UHJvZmlsZVJlcXVlc3QsIGV2dCwgXCJTYXZpbmcuLi5cIik7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGhhbmRsZUNhcmRGb3JtU3VibWl0KGV2dCkge1xyXG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gIGNvbnN0IHN1Ym1pdEJ1dHRvbiA9IGNhcmRGb3JtLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX3N1Ym1pdC1idXR0b25cIik7XHJcbiAgcmVuZGVyTG9hZGluZyh0cnVlLCBzdWJtaXRCdXR0b24pO1xyXG5cclxuICBhcGlcclxuICAgIC5hZGRDYXJkKHtcclxuICAgICAgbmFtZTogY2FyZENhcHRpb25JbnB1dC52YWx1ZSxcclxuICAgICAgbGluazogY2FyZExpbmtJbnB1dC52YWx1ZSxcclxuICAgIH0pXHJcbiAgICAudGhlbigoY2FyZERhdGEpID0+IHtcclxuICAgICAgY29uc3QgY2FyZEVsZW1lbnQgPSBnZXRDYXJkRWxlbWVudChjYXJkRGF0YSk7XHJcbiAgICAgIGNhcmRzTGlzdC5wcmVwZW5kKGNhcmRFbGVtZW50KTtcclxuICAgICAgZXZ0LnRhcmdldC5yZXNldCgpO1xyXG4gICAgICBjbG9zZU1vZGFsKGNhcmRNb2RhbCk7XHJcbiAgICB9KVxyXG4gICAgLmNhdGNoKGhhbmRsZUFwaUVycm9yKVxyXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xyXG4gICAgICByZW5kZXJMb2FkaW5nKGZhbHNlLCBzdWJtaXRCdXR0b24pO1xyXG4gICAgfSk7XHJcbn1cclxuXHJcbi8vIEVkaXQgTW9kYWwgTGlzdGVuZXJzXHJcbmVkaXRNb2RhbEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gIGVkaXRNb2RhbE5hbWVJbnB1dC52YWx1ZSA9IHByb2ZpbGVOYW1lLnRleHRDb250ZW50O1xyXG4gIGVkaXRNb2RhbERlc2NyaXB0aW9uSW5wdXQudmFsdWUgPSBwcm9maWxlRGVzY3JpcHRpb24udGV4dENvbnRlbnQ7XHJcbiAgcmVzZXRWYWxpZGF0aW9uKFxyXG4gICAgZWRpdEZvcm0sXHJcbiAgICBbZWRpdE1vZGFsTmFtZUlucHV0LCBlZGl0TW9kYWxEZXNjcmlwdGlvbklucHV0XSxcclxuICAgIHNldHRpbmdzXHJcbiAgKTtcclxuICBvcGVuTW9kYWwoZWRpdE1vZGFsKTtcclxufSk7XHJcblxyXG4vLyBBdmF0YXIgTW9kYWwgTGlzdGVuZXJcclxuYXZhdGFyRWRpdEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gIG9wZW5Nb2RhbChhdmF0YXJNb2RhbCk7XHJcbn0pO1xyXG5cclxuLy8gQ2FyZCBNb2RhbCBMaXN0ZW5lcnNcclxuY2FyZE1vZGFsQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgb3Blbk1vZGFsKGNhcmRNb2RhbCk7XHJcbn0pO1xyXG5cclxuY2FuY2VsRGVsZXRlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgY2xvc2VNb2RhbChkZWxldGVNb2RhbCk7XHJcbn0pO1xyXG5cclxuLy8gRm9ybSBMaXN0ZW5lcnNcclxuZWRpdEZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVFZGl0Rm9ybVN1Ym1pdCk7XHJcbmNhcmRGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgaGFuZGxlQ2FyZEZvcm1TdWJtaXQpO1xyXG5cclxuZGVsZXRlRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChldnQpID0+IHtcclxuICBldnQucHJldmVudERlZmF1bHQoKTtcclxuICBjb25zdCBzdWJtaXRCdXR0b24gPSBkZWxldGVGb3JtLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX3N1Ym1pdC1idXR0b25cIik7XHJcbiAgcmVuZGVyTG9hZGluZyh0cnVlLCBzdWJtaXRCdXR0b24sIFwiRGVsZXRlXCIsIFwiRGVsZXRpbmcuLi5cIik7XHJcblxyXG4gIGFwaVxyXG4gICAgLnJlbW92ZUNhcmQoZGVsZXRlRm9ybS5fY2FyZFRvRGVsZXRlLl9pZClcclxuICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgZGVsZXRlRm9ybS5fY2FyZFRvRGVsZXRlLnJlbW92ZSgpO1xyXG4gICAgICBjbG9zZU1vZGFsKGRlbGV0ZU1vZGFsKTtcclxuICAgIH0pXHJcbiAgICAuY2F0Y2goaGFuZGxlQXBpRXJyb3IpXHJcbiAgICAuZmluYWxseSgoKSA9PiB7XHJcbiAgICAgIHJlbmRlckxvYWRpbmcoZmFsc2UsIHN1Ym1pdEJ1dHRvbiwgXCJEZWxldGVcIik7XHJcbiAgICB9KTtcclxufSk7XHJcblxyXG4vLyBBdmF0YXIgRm9ybSBTdWJtaXQgSGFuZGxlclxyXG5hdmF0YXJGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGV2dCkgPT4ge1xyXG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gIGNvbnN0IHN1Ym1pdEJ1dHRvbiA9IGF2YXRhckZvcm0ucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fc3VibWl0LWJ1dHRvblwiKTtcclxuICByZW5kZXJMb2FkaW5nKHRydWUsIHN1Ym1pdEJ1dHRvbik7XHJcblxyXG4gIGFwaVxyXG4gICAgLnVwZGF0ZUF2YXRhcih7XHJcbiAgICAgIGF2YXRhcjogYXZhdGFyTGlua0lucHV0LnZhbHVlLFxyXG4gICAgfSlcclxuICAgIC50aGVuKCh1c2VyRGF0YSkgPT4ge1xyXG4gICAgICBpZiAocHJvZmlsZUF2YXRhckVsZW1lbnQpIHByb2ZpbGVBdmF0YXJFbGVtZW50LnNyYyA9IHVzZXJEYXRhLmF2YXRhcjtcclxuICAgICAgZXZ0LnRhcmdldC5yZXNldCgpO1xyXG4gICAgICBjbG9zZU1vZGFsKGF2YXRhck1vZGFsKTtcclxuICAgIH0pXHJcbiAgICAuY2F0Y2goaGFuZGxlQXBpRXJyb3IpXHJcbiAgICAuZmluYWxseSgoKSA9PiB7XHJcbiAgICAgIHJlbmRlckxvYWRpbmcoZmFsc2UsIHN1Ym1pdEJ1dHRvbik7XHJcbiAgICB9KTtcclxufSk7XHJcblxyXG5lbmFibGVWYWxpZGF0aW9uKHNldHRpbmdzKTtcclxuIiwiY2xhc3MgQXBpIHtcclxuICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7XHJcbiAgICB0aGlzLl9iYXNlVXJsID0gb3B0aW9ucy5iYXNlVXJsO1xyXG4gICAgdGhpcy5faGVhZGVycyA9IG9wdGlvbnMuaGVhZGVycztcclxuICB9XHJcblxyXG4gIF9jaGVja1Jlc3BvbnNlKHJlcykge1xyXG4gICAgaWYgKHJlcy5vaykge1xyXG4gICAgICByZXR1cm4gcmVzLmpzb24oKTtcclxuICAgIH1cclxuICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcclxuICB9XHJcblxyXG4gIF9yZXF1ZXN0KGVuZHBvaW50LCBvcHRpb25zID0ge30pIHtcclxuICAgIGNvbnN0IGZpbmFsT3B0aW9ucyA9IHtcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgICAgLi4ub3B0aW9ucyxcclxuICAgIH07XHJcbiAgICBjb25zdCB1cmwgPSBgJHt0aGlzLl9iYXNlVXJsfSR7ZW5kcG9pbnR9YDtcclxuICAgIHJldHVybiBmZXRjaCh1cmwsIGZpbmFsT3B0aW9ucykudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKTtcclxuICB9XHJcblxyXG4gIGdldFVzZXJJbmZvKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX3JlcXVlc3QoXCIvdXNlcnMvbWVcIik7XHJcbiAgfVxyXG5cclxuICBnZXRJbml0aWFsQ2FyZHMoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fcmVxdWVzdChcIi9jYXJkc1wiLCB7XHJcbiAgICAgIG1ldGhvZDogXCJHRVRcIixcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLy8gUEFUQ0ggL3VzZXJzL21lXHJcbiAgZWRpdFVzZXJJbmZvKHsgbmFtZSwgYWJvdXQgfSkge1xyXG4gICAgcmV0dXJuIHRoaXMuX3JlcXVlc3QoXCIvdXNlcnMvbWVcIiwge1xyXG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcclxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBuYW1lLCBhYm91dCB9KSxcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLy8gUEFUQ0ggL3VzZXJzL21lL2F2YXRhclxyXG4gIHVwZGF0ZUF2YXRhcih7IGF2YXRhciB9KSB7XHJcbiAgICByZXR1cm4gdGhpcy5fcmVxdWVzdChcIi91c2Vycy9tZS9hdmF0YXJcIiwge1xyXG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcclxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBhdmF0YXIgfSksXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8vIFBPU1QgL2NhcmRzXHJcbiAgYWRkQ2FyZCh7IG5hbWUsIGxpbmsgfSkge1xyXG4gICAgcmV0dXJuIHRoaXMuX3JlcXVlc3QoXCIvY2FyZHNcIiwge1xyXG4gICAgICBtZXRob2Q6IFwiUE9TVFwiLFxyXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IG5hbWUsIGxpbmsgfSksXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8vIERFTEVURSAvY2FyZHMvOmNhcmRJZFxyXG4gIHJlbW92ZUNhcmQoY2FyZElkKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtjYXJkSWR9YCwge1xyXG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xyXG4gIH1cclxuXHJcbiAgLy8gUFVUIC9jYXJkcy86Y2FyZElkL2xpa2VzXHJcbiAgbGlrZUNhcmQoY2FyZElkKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fcmVxdWVzdChgL2NhcmRzLyR7Y2FyZElkfS9saWtlc2AsIHtcclxuICAgICAgbWV0aG9kOiBcIlBVVFwiLFxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvLyBERUxFVEUgL2NhcmRzLzpjYXJkSWQvbGlrZXNcclxuICBkaXNsaWtlQ2FyZChjYXJkSWQpIHtcclxuICAgIHJldHVybiB0aGlzLl9yZXF1ZXN0KGAvY2FyZHMvJHtjYXJkSWR9L2xpa2VzYCwge1xyXG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8vIEhlbHBlcjogRmV0Y2ggaW5pdGlhbCBkYXRhIHNpbXVsdGFuZW91c2x5ICh1c2VyIGluZm8gJiBjYXJkcylcclxuICBmZXRjaEluaXRpYWxEYXRhKCkge1xyXG4gICAgcmV0dXJuIFByb21pc2UuYWxsKFt0aGlzLmdldFVzZXJJbmZvKCksIHRoaXMuZ2V0SW5pdGlhbENhcmRzKCldKTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IEFwaTtcclxuIl0sIm5hbWVzIjpbIl9fd2VicGFja19yZXF1aXJlX18iLCJzZXR0aW5ncyIsImZvcm1TZWxlY3RvciIsImlucHV0U2VsZWN0b3IiLCJzdWJtaXRCdXR0b25TZWxlY3RvciIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJpbnB1dEVycm9yQ2xhc3MiLCJlcnJvckNsYXNzIiwibG9nRXJyb3IiLCJtZXNzYWdlIiwiY29uc29sZSIsImVycm9yIiwiaGlkZUlucHV0RXJyb3IiLCJmb3JtRWxlbWVudCIsImlucHV0RWxlbWVudCIsImNvbmZpZyIsImVycm9yTWVzc2FnZUVsZW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiaWQiLCJ0ZXh0Q29udGVudCIsInJlbW92ZUF0dHJpYnV0ZSIsImNsYXNzTGlzdCIsInJlbW92ZSIsInRvZ2dsZUJ1dHRvblN0YXRlIiwiaW5wdXRMaXN0IiwiYnV0dG9uRWxlbWVudCIsInNvbWUiLCJpbnB1dCIsInZhbGlkaXR5IiwidmFsaWQiLCJoYXNJbnZhbGlkSW5wdXQiLCJkaXNhYmxlQnV0dG9uIiwiZGlzYWJsZWQiLCJhZGQiLCJyZXNldFZhbGlkYXRpb24iLCJmb3JFYWNoIiwicmVuZGVyTG9hZGluZyIsImlzTG9hZGluZyIsImJ1dHRvbiIsImJ1dHRvblRleHQiLCJsb2FkaW5nVGV4dCIsImhhbmRsZUFwaUVycm9yIiwidXNlck1lc3NhZ2UiLCJpbmNsdWRlcyIsInN0YXR1c0NvZGUiLCJtYXRjaCIsIlR5cGVFcnJvciIsImR1cmF0aW9uIiwiZXJyb3JEaXYiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJjbGFzc05hbWUiLCJzZXRBdHRyaWJ1dGUiLCJib2R5IiwiYXBwZW5kQ2hpbGQiLCJzZXRUaW1lb3V0IiwicGFyZW50Tm9kZSIsInJlbW92ZUNoaWxkIiwic2hvd0Vycm9yTWVzc2FnZSIsImFwaUJhc2VVcmwiLCJwcm9jZXNzIiwiZW52IiwiQVBJX0JBU0VfVVJMIiwiYXBpVG9rZW4iLCJBUElfVE9LRU4iLCJoZWFkZXJMb2dvIiwicHJvZmlsZUF2YXRhciIsImVkaXRCdXR0b25JbWciLCJhZGRCdXR0b25JbWciLCJwZW5jaWxJY29uIiwic3JjIiwibG9nb1BhdGgiLCJhdmF0YXJQYXRoIiwiZWRpdEJ1dHRvblBhdGgiLCJhZGRCdXR0b25QYXRoIiwiZWRpdExpZ2h0QnV0dG9uUGF0aCIsImFwaSIsImNvbnN0cnVjdG9yIiwib3B0aW9ucyIsInRoaXMiLCJfYmFzZVVybCIsImJhc2VVcmwiLCJfaGVhZGVycyIsImhlYWRlcnMiLCJfY2hlY2tSZXNwb25zZSIsInJlcyIsIm9rIiwianNvbiIsIlByb21pc2UiLCJyZWplY3QiLCJzdGF0dXMiLCJfcmVxdWVzdCIsImVuZHBvaW50IiwiZmluYWxPcHRpb25zIiwidXJsIiwiZmV0Y2giLCJ0aGVuIiwiZ2V0VXNlckluZm8iLCJnZXRJbml0aWFsQ2FyZHMiLCJtZXRob2QiLCJlZGl0VXNlckluZm8iLCJuYW1lIiwiYWJvdXQiLCJKU09OIiwic3RyaW5naWZ5IiwidXBkYXRlQXZhdGFyIiwiYXZhdGFyIiwiYWRkQ2FyZCIsImxpbmsiLCJyZW1vdmVDYXJkIiwiY2FyZElkIiwibGlrZUNhcmQiLCJkaXNsaWtlQ2FyZCIsImZldGNoSW5pdGlhbERhdGEiLCJhbGwiLCJhdXRob3JpemF0aW9uIiwidXNlcklkIiwidXNlckRhdGEiLCJfaWQiLCJwcm9maWxlTmFtZSIsInByb2ZpbGVEZXNjcmlwdGlvbiIsInByb2ZpbGVBdmF0YXJFbGVtZW50IiwiY2FyZHMiLCJjYXJkc0xpc3QiLCJBcnJheSIsImlzQXJyYXkiLCJjYXJkIiwiY2FyZEVsZW1lbnQiLCJnZXRDYXJkRWxlbWVudCIsImFwcGVuZCIsImNhdGNoIiwiZWRpdE1vZGFsQnV0dG9uIiwiY2FyZE1vZGFsQnV0dG9uIiwiY2xvc2VCdXR0b25zIiwicXVlcnlTZWxlY3RvckFsbCIsImRlbGV0ZU1vZGFsIiwiZGVsZXRlRm9ybSIsImNhbmNlbERlbGV0ZUJ1dHRvbiIsImF2YXRhckVkaXRCdXR0b24iLCJhdmF0YXJNb2RhbCIsImF2YXRhckZvcm0iLCJhdmF0YXJMaW5rSW5wdXQiLCJlZGl0TW9kYWwiLCJlZGl0Rm9ybSIsImVkaXRNb2RhbE5hbWVJbnB1dCIsImVkaXRNb2RhbERlc2NyaXB0aW9uSW5wdXQiLCJjYXJkTW9kYWwiLCJjYXJkRm9ybSIsImNhcmRMaW5rSW5wdXQiLCJjYXJkQ2FwdGlvbklucHV0IiwicHJldmlld01vZGFsIiwicHJldmlld0ltYWdlIiwicHJldmlld0NhcHRpb24iLCJjYXJkVGVtcGxhdGUiLCJkYXRhIiwiY29udGVudCIsImNsb25lTm9kZSIsImNhcmRUaXRsZSIsImNhcmRJbWFnZSIsImNhcmRMaWtlQnV0dG9uIiwiY2FyZExpa2VDb3VudCIsImNhcmREZWxldGVCdXR0b24iLCJhbHQiLCJvbmVycm9yIiwibGlrZXNDb3VudCIsImxpa2VzIiwibGVuZ3RoIiwiaXNMaWtlZEJ5VXNlciIsImxpa2UiLCJ0b1N0cmluZyIsImFkZEV2ZW50TGlzdGVuZXIiLCJjb250YWlucyIsInVwZGF0ZWRDYXJkIiwiaXNMaWtlZCIsInRvZ2dsZSIsIm9wZW5Nb2RhbCIsIl9jYXJkVG9EZWxldGUiLCJtb2RhbCIsImhhbmRsZU92ZXJsYXlDbGljayIsImV2ZW50IiwidGFyZ2V0IiwiY2xvc2VNb2RhbCIsImhhbmRsZUVzY2FwZUtleVByZXNzIiwia2V5IiwiX2hhbmRsZU92ZXJsYXlDbGljayIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJfaGFuZGxlRXNjYXBlS2V5UHJlc3MiLCJtYWtlRWRpdFByb2ZpbGVSZXF1ZXN0IiwidmFsdWUiLCJjbG9zZXN0IiwiZXZ0IiwicmVxdWVzdCIsInByZXZlbnREZWZhdWx0Iiwic3VibWl0QnV0dG9uIiwic3VibWl0dGVyIiwiaW5pdGlhbFRleHQiLCJmaW5hbGx5IiwiaGFuZGxlU3VibWl0IiwiY2FyZERhdGEiLCJwcmVwZW5kIiwicmVzZXQiLCJmcm9tIiwic2V0RXZlbnRMaXN0ZW5lcnMiLCJjaGVja0lucHV0VmFsaWRpdHkiLCJzaG93SW5wdXRFcnJvciIsImVycm9yTWVzc2FnZSIsInZhbGlkYXRpb25NZXNzYWdlIiwiZW5hYmxlVmFsaWRhdGlvbiJdLCJzb3VyY2VSb290IjoiIn0=